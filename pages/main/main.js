"use strict";
Page({
    onShareAppMessage: function () {
        return {
            title: "听个戏吧",
            path: "pages/main"
        };
    },
    data: {
        currentOperaIndex: 0,
        operas: [],
        recorderManager: wx.getRecorderManager(),
        isRecording: false,
        recordStartTime: new Date()
    },
    onLoad: function () {
        this.initOperas();
        this.initRecorders();
    },
    initOperas: function () {
        var _this = this;
        var operas = [];
        for (var i = 0; i < 5; i++) {
            operas.push({
                title: "黄梅戏" + i,
                link: "http://wxsnsdy.tc.qq.com/105/20210/snsdyvideodownload?filekey=30280201010421301f0201690402534804102ca905ce620b1241b726bc41dcff44e00204012882540400&bizid=1023&hy=SH&fileparam=302c020101042530230204136ffd93020457e3c4ff02024ef202031e8d7f02030f42400204045a320a0201000400",
                context: wx.createVideoContext("opera-" + i)
            });
        }
        this.setData({ operas: operas }, function () {
            _this.data.operas[0].context.play();
        });
    },
    initRecorders: function () {
        var recorderManager = this.data.recorderManager;
        recorderManager.onStop(function (res) {
            console.log(res);
            wx.uploadFile({
                url: "https://xxxx",
                filePath: res.tempFilePath,
                name: "file",
                header: {
                    "content-type": "multipart/form-data"
                },
                success: function (res) {
                    console.log(res);
                },
                fail: function () {
                    console.log("语音识别失败");
                }
            });
        });
    },
    switchToNextVideo: function (nextIndex) {
        var _this = this;
        var prevIndex = this.data.currentOperaIndex;
        this.data.operas[prevIndex].context.seek(0);
        this.data.operas[prevIndex].context.pause();
        this.setData({
            currentOperaIndex: nextIndex
        }, function () {
            _this.data.operas[nextIndex].context.play();
        });
    },
    onSwiperChange: function (e) {
        this.switchToNextVideo(e.detail.current);
    },
    onVideoEnded: function () {
        this.switchToNextVideo(this.data.currentOperaIndex + 1);
    },
    startRecord: function () {
        var _a = this.data, recorderManager = _a.recorderManager, isRecording = _a.isRecording;
        if (isRecording) {
            return;
        }
        console.log("record start");
        this.setData({ isRecording: true, recordStartTime: new Date() });
        var options = {
            duration: 10000,
            sampleRate: 16000,
            numberOfChannels: 1,
            encodeBitRate: 64000,
            format: "mp3",
            frameSize: 50
        };
        recorderManager.start(options);
    },
    stopRecord: function () {
        var _a = this.data, recorderManager = _a.recorderManager, isRecording = _a.isRecording, recordStartTime = _a.recordStartTime;
        if (!isRecording) {
            return;
        }
        var duration = new Date().getTime() - recordStartTime.getTime();
        if (duration < 1000) {
            console.log("record too short ");
            return;
        }
        console.log("record end ", duration);
        this.setData({ isRecording: false });
        recorderManager.stop();
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIm1haW4udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQXlCQSxJQUFJLENBQW1CO0lBQ3JCLGlCQUFpQjtRQUNmLE9BQU87WUFDTCxLQUFLLEVBQUUsTUFBTTtZQUNiLElBQUksRUFBRSxZQUFZO1NBQ25CLENBQUM7SUFDSixDQUFDO0lBRUQsSUFBSSxFQUFFO1FBQ0osaUJBQWlCLEVBQUUsQ0FBQztRQUNwQixNQUFNLEVBQUUsRUFBRTtRQUNWLGVBQWUsRUFBRSxFQUFFLENBQUMsa0JBQWtCLEVBQUU7UUFDeEMsV0FBVyxFQUFFLEtBQUs7UUFDbEIsZUFBZSxFQUFFLElBQUksSUFBSSxFQUFFO0tBQzVCO0lBRUQsTUFBTTtRQUNKLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztRQUNsQixJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7SUFDdkIsQ0FBQztJQUVELFVBQVU7UUFBVixpQkFlQztRQWJDLElBQU0sTUFBTSxHQUFrQixFQUFFLENBQUM7UUFDakMsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRTtZQUMxQixNQUFNLENBQUMsSUFBSSxDQUFDO2dCQUNWLEtBQUssRUFBRSxLQUFLLEdBQUcsQ0FBQztnQkFDaEIsSUFBSSxFQUNGLDRRQUE0UTtnQkFDOVEsT0FBTyxFQUFFLEVBQUUsQ0FBQyxrQkFBa0IsQ0FBQyxXQUFTLENBQUcsQ0FBQzthQUM3QyxDQUFDLENBQUM7U0FDSjtRQUVELElBQUksQ0FBQyxPQUFRLENBQUMsRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLEVBQUU7WUFDaEMsS0FBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ3JDLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELGFBQWE7UUFDSCxJQUFBLDJDQUFlLENBQWU7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LENBQUMsRUFBRSxXQUFXLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQztRQUV0QyxlQUFlLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDekIsQ0FBQztDQUNGLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImludGVyZmFjZSBJT3BlcmEge1xuICByZWFkb25seSBsaW5rOiBzdHJpbmc7XG4gIHJlYWRvbmx5IHRpdGxlOiBzdHJpbmc7XG4gIHJlYWRvbmx5IGNvbnRleHQ6IHd4LlZpZGVvQ29udGV4dDtcbn1cblxuaW50ZXJmYWNlIElQYWdlRGF0YSB7XG4gIG9wZXJhczogQXJyYXk8SU9wZXJhPjtcbiAgY3VycmVudE9wZXJhSW5kZXg6IG51bWJlcjtcbiAgcmVjb3JkZXJNYW5hZ2VyOiB3eC5SZWNvcmRlck1hbmFnZXI7XG4gIGlzUmVjb3JkaW5nOiBib29sZWFuO1xuICByZWNvcmRTdGFydFRpbWU6IERhdGU7XG59XG5cbmludGVyZmFjZSBJUGFnZSB7XG4gIGRhdGE6IElQYWdlRGF0YTtcbiAgb25Td2lwZXJDaGFuZ2UoZTogYW55KTogdm9pZDtcbiAgb25WaWRlb0VuZGVkKCk6IHZvaWQ7XG4gIHN3aXRjaFRvTmV4dFZpZGVvKG5leHRJbmRleDogbnVtYmVyKTogdm9pZDtcbiAgc3RhcnRSZWNvcmQoKTogdm9pZDtcbiAgc3RvcFJlY29yZCgpOiB2b2lkO1xuICBpbml0T3BlcmFzKCk6IHZvaWQ7XG4gIGluaXRSZWNvcmRlcnMoKTogdm9pZDtcbn1cblxuUGFnZTxJUGFnZURhdGEsIElQYWdlPih7XG4gIG9uU2hhcmVBcHBNZXNzYWdlKCkge1xuICAgIHJldHVybiB7XG4gICAgICB0aXRsZTogXCLlkKzkuKrmiI/lkKdcIixcbiAgICAgIHBhdGg6IFwicGFnZXMvbWFpblwiXG4gICAgfTtcbiAgfSxcblxuICBkYXRhOiB7XG4gICAgY3VycmVudE9wZXJhSW5kZXg6IDAsXG4gICAgb3BlcmFzOiBbXSxcbiAgICByZWNvcmRlck1hbmFnZXI6IHd4LmdldFJlY29yZGVyTWFuYWdlcigpLFxuICAgIGlzUmVjb3JkaW5nOiBmYWxzZSxcbiAgICByZWNvcmRTdGFydFRpbWU6IG5ldyBEYXRlKClcbiAgfSxcblxuICBvbkxvYWQoKSB7XG4gICAgdGhpcy5pbml0T3BlcmFzKCk7XG4gICAgdGhpcy5pbml0UmVjb3JkZXJzKCk7XG4gIH0sXG5cbiAgaW5pdE9wZXJhcygpIHtcbiAgICAvLyBmZXRjaCBhIHBhZ2VcbiAgICBjb25zdCBvcGVyYXM6IEFycmF5PElPcGVyYT4gPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDU7IGkrKykge1xuICAgICAgb3BlcmFzLnB1c2goe1xuICAgICAgICB0aXRsZTogXCLpu4TmooXmiI9cIiArIGksXG4gICAgICAgIGxpbms6XG4gICAgICAgICAgXCJodHRwOi8vd3hzbnNkeS50Yy5xcS5jb20vMTA1LzIwMjEwL3Nuc2R5dmlkZW9kb3dubG9hZD9maWxla2V5PTMwMjgwMjAxMDEwNDIxMzAxZjAyMDE2OTA0MDI1MzQ4MDQxMDJjYTkwNWNlNjIwYjEyNDFiNzI2YmM0MWRjZmY0NGUwMDIwNDAxMjg4MjU0MDQwMCZiaXppZD0xMDIzJmh5PVNIJmZpbGVwYXJhbT0zMDJjMDIwMTAxMDQyNTMwMjMwMjA0MTM2ZmZkOTMwMjA0NTdlM2M0ZmYwMjAyNGVmMjAyMDMxZThkN2YwMjAzMGY0MjQwMDIwNDA0NWEzMjBhMDIwMTAwMDQwMFwiLFxuICAgICAgICBjb250ZXh0OiB3eC5jcmVhdGVWaWRlb0NvbnRleHQoYG9wZXJhLSR7aX1gKVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgdGhpcy5zZXREYXRhISh7IG9wZXJhczogb3BlcmFzIH0sICgpID0+IHtcbiAgICAgIHRoaXMuZGF0YS5vcGVyYXNbMF0uY29udGV4dC5wbGF5KCk7XG4gICAgfSk7XG4gIH0sXG5cbiAgaW5pdFJlY29yZGVycygpIHtcbiAgICBjb25zdCB7IHJlY29yZGVyTWFuYWdlciB9ID0gdGhpcy5kYXRhO1xuXG4gICAgcmVjb3JkZXJNYW5hZ2VyLm9uU3RvcChyZXMgPT4ge1xuICAgICAgY29uc29sZS5sb2cocmVzKTtcblxuICAgICAgd3gudXBsb2FkRmlsZSh7XG4gICAgICAgIHVybDogXCJodHRwczovL3h4eHhcIixcbiAgICAgICAgZmlsZVBhdGg6IHJlcy50ZW1wRmlsZVBhdGgsXG4gICAgICAgIG5hbWU6IFwiZmlsZVwiLFxuICAgICAgICBoZWFkZXI6IHtcbiAgICAgICAgICBcImNvbnRlbnQtdHlwZVwiOiBcIm11bHRpcGFydC9mb3JtLWRhdGFcIlxuICAgICAgICB9LFxuICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihyZXMpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhyZXMpO1xuICAgICAgICB9LFxuICAgICAgICBmYWlsOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIuivremfs+ivhuWIq+Wksei0pVwiKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0sXG5cbiAgc3dpdGNoVG9OZXh0VmlkZW8obmV4dEluZGV4OiBudW1iZXIpIHtcbiAgICBjb25zdCBwcmV2SW5kZXggPSB0aGlzLmRhdGEuY3VycmVudE9wZXJhSW5kZXg7XG4gICAgLy8g5YGc5q2i5LiK5LiA6aG155qE6KeG6aKRXG4gICAgdGhpcy5kYXRhLm9wZXJhc1twcmV2SW5kZXhdLmNvbnRleHQuc2VlaygwKTtcbiAgICB0aGlzLmRhdGEub3BlcmFzW3ByZXZJbmRleF0uY29udGV4dC5wYXVzZSgpO1xuXG4gICAgdGhpcy5zZXREYXRhIShcbiAgICAgIHtcbiAgICAgICAgY3VycmVudE9wZXJhSW5kZXg6IG5leHRJbmRleFxuICAgICAgfSxcbiAgICAgICgpID0+IHtcbiAgICAgICAgLy8g5byA5aeL5b2T5YmN6aG155qE6KeG6aKRXG4gICAgICAgIHRoaXMuZGF0YS5vcGVyYXNbbmV4dEluZGV4XS5jb250ZXh0LnBsYXkoKTtcbiAgICAgIH1cbiAgICApO1xuICB9LFxuXG4gIG9uU3dpcGVyQ2hhbmdlKGU6IGFueSkge1xuICAgIHRoaXMuc3dpdGNoVG9OZXh0VmlkZW8oZS5kZXRhaWwuY3VycmVudCk7XG4gIH0sXG5cbiAgb25WaWRlb0VuZGVkKCkge1xuICAgIHRoaXMuc3dpdGNoVG9OZXh0VmlkZW8odGhpcy5kYXRhLmN1cnJlbnRPcGVyYUluZGV4ICsgMSk7XG4gIH0sXG5cbiAgc3RhcnRSZWNvcmQoKSB7XG4gICAgY29uc3QgeyByZWNvcmRlck1hbmFnZXIsIGlzUmVjb3JkaW5nIH0gPSB0aGlzLmRhdGE7XG5cbiAgICBpZiAoaXNSZWNvcmRpbmcpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZyhcInJlY29yZCBzdGFydFwiKTtcblxuICAgIHRoaXMuc2V0RGF0YSEoeyBpc1JlY29yZGluZzogdHJ1ZSwgcmVjb3JkU3RhcnRUaW1lOiBuZXcgRGF0ZSgpIH0pO1xuXG4gICAgY29uc3Qgb3B0aW9ucyA9IHtcbiAgICAgIGR1cmF0aW9uOiAxMDAwMCxcbiAgICAgIHNhbXBsZVJhdGU6IDE2MDAwLFxuICAgICAgbnVtYmVyT2ZDaGFubmVsczogMSxcbiAgICAgIGVuY29kZUJpdFJhdGU6IDY0MDAwLFxuICAgICAgZm9ybWF0OiBcIm1wM1wiLFxuICAgICAgZnJhbWVTaXplOiA1MFxuICAgIH0gYXMgd3guUmVjb3JkZXJNYW5hZ2VyU3RhcnRPcHRpb247XG5cbiAgICByZWNvcmRlck1hbmFnZXIuc3RhcnQob3B0aW9ucyk7XG4gIH0sXG5cbiAgc3RvcFJlY29yZCgpIHtcbiAgICBjb25zdCB7IHJlY29yZGVyTWFuYWdlciwgaXNSZWNvcmRpbmcsIHJlY29yZFN0YXJ0VGltZSB9ID0gdGhpcy5kYXRhO1xuXG4gICAgaWYgKCFpc1JlY29yZGluZykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IGR1cmF0aW9uID0gbmV3IERhdGUoKS5nZXRUaW1lKCkgLSByZWNvcmRTdGFydFRpbWUuZ2V0VGltZSgpO1xuXG4gICAgaWYgKGR1cmF0aW9uIDwgMTAwMCkge1xuICAgICAgY29uc29sZS5sb2coXCJyZWNvcmQgdG9vIHNob3J0IFwiKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZyhcInJlY29yZCBlbmQgXCIsIGR1cmF0aW9uKTtcblxuICAgIHRoaXMuc2V0RGF0YSEoeyBpc1JlY29yZGluZzogZmFsc2UgfSk7XG5cbiAgICByZWNvcmRlck1hbmFnZXIuc3RvcCgpO1xuICB9XG59KTtcbiJdfQ==