"use strict";
Page({
    onShareAppMessage: function () {
        return {
            title: "听个戏吧",
            path: "pages/main"
        };
    },
    data: {
        currentOperaIndex: 0,
        operas: [],
        recorderManager: wx.getRecorderManager(),
        isRecording: false,
        recordStartTime: new Date()
    },
    onLoad: function () {
        this.initOperas();
        this.initRecorders();
    },
    initOperas: function () {
        var _this = this;
        wx.request({
            url: 'http://localhost:3000/operas',
            data: {
                pageIndex: 0,
                pageSize: 5
            },
            success: function (res) {
                var operaList = res.data;
                var operas = operaList.map(function (dto, i) { return ({
                    title: dto.title,
                    link: dto.link,
                    context: wx.createVideoContext("opera-" + i)
                }); });
                _this.setData({ operas: operas }, function () {
                    _this.data.operas[0].context.play();
                });
            }
        });
    },
    initRecorders: function () {
        var recorderManager = this.data.recorderManager;
        recorderManager.onStop(function (res) {
            console.log(res);
            wx.uploadFile({
                url: "https://xxxx",
                filePath: res.tempFilePath,
                name: "file",
                header: {
                    "content-type": "multipart/form-data"
                },
                success: function (res) {
                    console.log(res);
                },
                fail: function () {
                    console.log("语音识别失败");
                }
            });
        });
    },
    switchToNextVideo: function (nextIndex) {
        var _this = this;
        var prevIndex = this.data.currentOperaIndex;
        this.data.operas[prevIndex].context.seek(0);
        this.data.operas[prevIndex].context.pause();
        this.setData({
            currentOperaIndex: nextIndex
        }, function () {
            _this.data.operas[nextIndex].context.play();
        });
    },
    onSwiperChange: function (e) {
        this.switchToNextVideo(e.detail.current);
    },
    onVideoEnded: function () {
        var _a = this.data, currentOperaIndex = _a.currentOperaIndex, operas = _a.operas;
        if (currentOperaIndex === operas.length - 1) {
            return;
        }
        this.switchToNextVideo(this.data.currentOperaIndex + 1);
    },
    startRecord: function () {
        var _a = this.data, recorderManager = _a.recorderManager, isRecording = _a.isRecording;
        if (isRecording) {
            return;
        }
        console.log("record start");
        this.setData({ isRecording: true, recordStartTime: new Date() });
        var options = {
            duration: 10000,
            sampleRate: 16000,
            numberOfChannels: 1,
            encodeBitRate: 64000,
            format: 'PCM',
            frameSize: 50
        };
        recorderManager.start(options);
    },
    stopRecord: function () {
        var _a = this.data, recorderManager = _a.recorderManager, isRecording = _a.isRecording, recordStartTime = _a.recordStartTime;
        if (!isRecording) {
            return;
        }
        var duration = new Date().getTime() - recordStartTime.getTime();
        if (duration < 1000) {
            console.log("record too short ");
            return;
        }
        console.log("record end ", duration);
        this.setData({ isRecording: false });
        recorderManager.stop();
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIm1haW4udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQThCQSxJQUFJLENBQW1CO0lBQ3JCLGlCQUFpQjtRQUNmLE9BQU87WUFDTCxLQUFLLEVBQUUsTUFBTTtZQUNiLElBQUksRUFBRSxZQUFZO1NBQ25CLENBQUM7SUFDSixDQUFDO0lBRUQsSUFBSSxFQUFFO1FBQ0osaUJBQWlCLEVBQUUsQ0FBQztRQUNwQixNQUFNLEVBQUUsRUFBRTtRQUNWLGVBQWUsRUFBRSxFQUFFLENBQUMsa0JBQWtCLEVBQUU7UUFDeEMsV0FBVyxFQUFFLEtBQUs7UUFDbEIsZUFBZSxFQUFFLElBQUksSUFBSSxFQUFFO0tBQzVCO0lBRUQsTUFBTTtRQUNKLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztRQUNsQixJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7SUFDdkIsQ0FBQztJQUVELFVBQVU7UUFBVixpQkFxQkM7UUFuQkMsRUFBRSxDQUFDLE9BQU8sQ0FBQztZQUNULEdBQUcsRUFBRSw4QkFBOEI7WUFDbkMsSUFBSSxFQUFFO2dCQUNKLFNBQVMsRUFBRSxDQUFDO2dCQUNaLFFBQVEsRUFBRSxDQUFDO2FBQ1o7WUFDRCxPQUFPLEVBQUUsVUFBQyxHQUFHO2dCQUNYLElBQU0sU0FBUyxHQUFnQixHQUFHLENBQUMsSUFBSSxDQUFDO2dCQUN4QyxJQUFNLE1BQU0sR0FBYSxTQUFTLENBQUMsR0FBRyxDQUFDLFVBQUMsR0FBRyxFQUFFLENBQUMsSUFBSyxPQUFBLENBQUM7b0JBQ2xELEtBQUssRUFBRSxHQUFHLENBQUMsS0FBSztvQkFDaEIsSUFBSSxFQUFFLEdBQUcsQ0FBQyxJQUFJO29CQUNkLE9BQU8sRUFBRSxFQUFFLENBQUMsa0JBQWtCLENBQUMsV0FBUyxDQUFHLENBQUM7aUJBQzdDLENBQUMsRUFKaUQsQ0FJakQsQ0FBQyxDQUFDO2dCQUVKLEtBQUksQ0FBQyxPQUFRLENBQUMsRUFBRSxNQUFNLEVBQUUsTUFB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QUE2QixDQUFDO1FBRXBFLElBQUksQ0FBQyxXQUFXLEVBQUU7WUFDaEIsT0FBTztTQUNSO1FBRUQsSUFBTSxRQUFRLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQyxPQUFPLEVBQUUsR0FBRyxlQUFlLENBQUMsT0FBTyxFQUFFLENBQUM7UUFFbEUsSUFBSSxRQUFRLEdBQUcsSUFBSSxFQUFFO1lBQ25CLE9BQU8sQ0FBQyxHQUFHLENBQUMsbUJBQW1CLENBQUMsQ0FBQztZQUNqQyxPQUFPO1NBQ1I7UUFFRCxPQUFPLENBQUMsR0FBRyxDQUFDLGFBQWEsRUFBRSxRQUFRLENBQUMsQ0FBQztRQUVyQyxJQUFJLENBQUMsT0FBUSxDQUFDLEVBQUUsV0FBVyxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUM7UUFFdEMsZUFBZSxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ3pCLENBQUM7Q0FDRixDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbnRlcmZhY2UgSU9wZXJhIHtcbiAgcmVhZG9ubHkgbGluazogc3RyaW5nO1xuICByZWFkb25seSB0aXRsZTogc3RyaW5nO1xuICByZWFkb25seSBjb250ZXh0OiB3eC5WaWRlb0NvbnRleHQ7XG59XG5cbmludGVyZmFjZSBJUGFnZURhdGEge1xuICBvcGVyYXM6IElPcGVyYVtdO1xuICBjdXJyZW50T3BlcmFJbmRleDogbnVtYmVyO1xuICByZWNvcmRlck1hbmFnZXI6IHd4LlJlY29yZGVyTWFuYWdlcjtcbiAgaXNSZWNvcmRpbmc6IGJvb2xlYW47XG4gIHJlY29yZFN0YXJ0VGltZTogRGF0ZTtcbn1cblxuaW50ZXJmYWNlIElQYWdlIHtcbiAgZGF0YTogSVBhZ2VEYXRhO1xuICBvblN3aXBlckNoYW5nZShlOiBhbnkpOiB2b2lkO1xuICBvblZpZGVvRW5kZWQoKTogdm9pZDtcbiAgc3dpdGNoVG9OZXh0VmlkZW8obmV4dEluZGV4OiBudW1iZXIpOiB2b2lkO1xuICBzdGFydFJlY29yZCgpOiB2b2lkO1xuICBzdG9wUmVjb3JkKCk6IHZvaWQ7XG4gIGluaXRPcGVyYXMoKTogdm9pZDtcbiAgaW5pdFJlY29yZGVycygpOiB2b2lkO1xufVxuXG5pbnRlcmZhY2UgSU9wZXJhRFRPIHtcbiAgcmVhZG9ubHkgdGl0bGU6IHN0cmluZztcbiAgcmVhZG9ubHkgbGluazogc3RyaW5nO1xufVxuXG5QYWdlPElQYWdlRGF0YSwgSVBhZ2U+KHtcbiAgb25TaGFyZUFwcE1lc3NhZ2UoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHRpdGxlOiBcIuWQrOS4quaIj+WQp1wiLFxuICAgICAgcGF0aDogXCJwYWdlcy9tYWluXCJcbiAgICB9O1xuICB9LFxuXG4gIGRhdGE6IHtcbiAgICBjdXJyZW50T3BlcmFJbmRleDogMCxcbiAgICBvcGVyYXM6IFtdLFxuICAgIHJlY29yZGVyTWFuYWdlcjogd3guZ2V0UmVjb3JkZXJNYW5hZ2VyKCksXG4gICAgaXNSZWNvcmRpbmc6IGZhbHNlLFxuICAgIHJlY29yZFN0YXJ0VGltZTogbmV3IERhdGUoKVxuICB9LFxuXG4gIG9uTG9hZCgpIHtcbiAgICB0aGlzLmluaXRPcGVyYXMoKTtcbiAgICB0aGlzLmluaXRSZWNvcmRlcnMoKTtcbiAgfSxcblxuICBpbml0T3BlcmFzKCkge1xuICAgIC8vIGZldGNoIGEgcGFnZVxuICAgIHd4LnJlcXVlc3Qoe1xuICAgICAgdXJsOiAnaHR0cDovL2xvY2FsaG9zdDozMDAwL29wZXJhcycsXG4gICAgICBkYXRhOiB7XG4gICAgICAgIHBhZ2VJbmRleDogMCxcbiAgICAgICAgcGFnZVNpemU6IDVcbiAgICAgIH0sXG4gICAgICBzdWNjZXNzOiAocmVzKSA9PiB7XG4gICAgICAgIGNvbnN0IG9wZXJhTGlzdCA9IDxJT3BlcmFEVE9bXT5yZXMuZGF0YTtcbiAgICAgICAgY29uc3Qgb3BlcmFzOiBJT3BlcmFbXSA9IG9wZXJhTGlzdC5tYXAoKGR0bywgaSkgPT4gKHtcbiAgICAgICAgICB0aXRsZTogZHRvLnRpdGxlLFxuICAgICAgICAgIGxpbms6IGR0by5saW5rLFxuICAgICAgICAgIGNvbnRleHQ6IHd4LmNyZWF0ZVZpZGVvQ29udGV4dChgb3BlcmEtJHtpfWApXG4gICAgICAgIH0pKTtcblxuICAgICAgICB0aGlzLnNldERhdGEhKHsgb3BlcmFzOiBvcGVyYXMgfSwgKCkgPT4ge1xuICAgICAgICAgIHRoaXMuZGF0YS5vcGVyYXNbMF0uY29udGV4dC5wbGF5KCk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pXG4gIH0sXG5cbiAgaW5pdFJlY29yZGVycygpIHtcbiAgICBjb25zdCB7IHJlY29yZGVyTWFuYWdlciB9ID0gdGhpcy5kYXRhO1xuXG4gICAgcmVjb3JkZXJNYW5hZ2VyLm9uU3RvcChyZXMgPT4ge1xuICAgICAgY29uc29sZS5sb2cocmVzKTtcblxuICAgICAgd3gudXBsb2FkRmlsZSh7XG4gICAgICAgIHVybDogXCJodHRwczovL3h4eHhcIixcbiAgICAgICAgZmlsZVBhdGg6IHJlcy50ZW1wRmlsZVBhdGgsXG4gICAgICAgIG5hbWU6IFwiZmlsZVwiLFxuICAgICAgICBoZWFkZXI6IHtcbiAgICAgICAgICBcImNvbnRlbnQtdHlwZVwiOiBcIm11bHRpcGFydC9mb3JtLWRhdGFcIlxuICAgICAgICB9LFxuICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihyZXMpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhyZXMpO1xuICAgICAgICB9LFxuICAgICAgICBmYWlsOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIuivremfs+ivhuWIq+Wksei0pVwiKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0sXG5cbiAgc3dpdGNoVG9OZXh0VmlkZW8obmV4dEluZGV4OiBudW1iZXIpIHtcbiAgICBjb25zdCBwcmV2SW5kZXggPSB0aGlzLmRhdGEuY3VycmVudE9wZXJhSW5kZXg7XG4gICAgLy8g5YGc5q2i5LiK5LiA6aG155qE6KeG6aKRXG4gICAgdGhpcy5kYXRhLm9wZXJhc1twcmV2SW5kZXhdLmNvbnRleHQuc2VlaygwKTtcbiAgICB0aGlzLmRhdGEub3BlcmFzW3ByZXZJbmRleF0uY29udGV4dC5wYXVzZSgpO1xuXG4gICAgdGhpcy5zZXREYXRhIShcbiAgICAgIHtcbiAgICAgICAgY3VycmVudE9wZXJhSW5kZXg6IG5leHRJbmRleFxuICAgICAgfSxcbiAgICAgICgpID0+IHtcbiAgICAgICAgLy8g5byA5aeL5b2T5YmN6aG155qE6KeG6aKRXG4gICAgICAgIHRoaXMuZGF0YS5vcGVyYXNbbmV4dEluZGV4XS5jb250ZXh0LnBsYXkoKTtcbiAgICAgIH1cbiAgICApO1xuICB9LFxuXG4gIG9uU3dpcGVyQ2hhbmdlKGU6IGFueSkge1xuICAgIHRoaXMuc3dpdGNoVG9OZXh0VmlkZW8oZS5kZXRhaWwuY3VycmVudCk7XG4gIH0sXG5cbiAgb25WaWRlb0VuZGVkKCkge1xuICAgIGNvbnN0IHsgY3VycmVudE9wZXJhSW5kZXgsIG9wZXJhcyB9ID0gdGhpcy5kYXRhO1xuXG4gICAgaWYgKGN1cnJlbnRPcGVyYUluZGV4ID09PSBvcGVyYXMubGVuZ3RoIC0gMSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuc3dpdGNoVG9OZXh0VmlkZW8odGhpcy5kYXRhLmN1cnJlbnRPcGVyYUluZGV4ICsgMSk7XG4gIH0sXG5cbiAgc3RhcnRSZWNvcmQoKSB7XG4gICAgY29uc3QgeyByZWNvcmRlck1hbmFnZXIsIGlzUmVjb3JkaW5nIH0gPSB0aGlzLmRhdGE7XG5cbiAgICBpZiAoaXNSZWNvcmRpbmcpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZyhcInJlY29yZCBzdGFydFwiKTtcblxuICAgIHRoaXMuc2V0RGF0YSEoeyBpc1JlY29yZGluZzogdHJ1ZSwgcmVjb3JkU3RhcnRUaW1lOiBuZXcgRGF0ZSgpIH0pO1xuXG4gICAgY29uc3Qgb3B0aW9ucyA9IHtcbiAgICAgIGR1cmF0aW9uOiAxMDAwMCxcbiAgICAgIHNhbXBsZVJhdGU6IDE2MDAwLFxuICAgICAgbnVtYmVyT2ZDaGFubmVsczogMSxcbiAgICAgIGVuY29kZUJpdFJhdGU6IDY0MDAwLFxuICAgICAgZm9ybWF0OiAnUENNJyxcbiAgICAgIGZyYW1lU2l6ZTogNTBcbiAgICB9IGFzIHd4LlJlY29yZGVyTWFuYWdlclN0YXJ0T3B0aW9uO1xuXG4gICAgcmVjb3JkZXJNYW5hZ2VyLnN0YXJ0KG9wdGlvbnMpO1xuICB9LFxuXG4gIHN0b3BSZWNvcmQoKSB7XG4gICAgY29uc3QgeyByZWNvcmRlck1hbmFnZXIsIGlzUmVjb3JkaW5nLCByZWNvcmRTdGFydFRpbWUgfSA9IHRoaXMuZGF0YTtcblxuICAgIGlmICghaXNSZWNvcmRpbmcpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBkdXJhdGlvbiA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpIC0gcmVjb3JkU3RhcnRUaW1lLmdldFRpbWUoKTtcblxuICAgIGlmIChkdXJhdGlvbiA8IDEwMDApIHtcbiAgICAgIGNvbnNvbGUubG9nKFwicmVjb3JkIHRvbyBzaG9ydCBcIik7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coXCJyZWNvcmQgZW5kIFwiLCBkdXJhdGlvbik7XG5cbiAgICB0aGlzLnNldERhdGEhKHsgaXNSZWNvcmRpbmc6IGZhbHNlIH0pO1xuXG4gICAgcmVjb3JkZXJNYW5hZ2VyLnN0b3AoKTtcbiAgfVxufSk7XG4iXX0=